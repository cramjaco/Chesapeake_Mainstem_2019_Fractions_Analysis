# Analyis of size fractionated amplicon data from the Chesapeake Bay Mainstem 2019

Author: Jacob Cram

Date: 2022 November 09

This project contains the analysis of the amplicon sequencing data from Jacob Cram's lab's
size fractionation data from a 2019 RV Carson cruise on the Chesapeake Bay. 
These data complement the manuscript: "Microbial diversity and abundance vary along latitudinal and particle size gradients in the Chesapeake Bay".

Authors: Jacob Cram, Ashley Hollins, Alexandra McCarty, Grace Martinez, Clara Fuchsman
Data were collected by Jacob Cram, Ashley Hollins, Emily Dougherty, Mekayla Reynolds

Directory Structure follows:

 *  `RScripts`: Some produce intermediate output used by other things and some produce figures.
    * `InitalProcessing_3.R`: Data wrangling and pre-processing of ASV and environmental data. This is slow, and so generally I used its saved environment output in most of the notebooks.
    * `Brigandine_2.R `: Abundances of bacteria on different sizes of particles. Phyla, Planktomycetes ASVs, abundant ASVs on > 5 micron particles
    * `CBMap_Transect.R`: Make a map of all stations.
    * `AmpliconsBiogeochem`: Identify amplicons with names or closest sequenced relatives involved in key biogeochemical cycles. Returns a plot of the organisms' abundances.
    
* `ActiveNotebooks`: Notebook files in which much of the analysis in the manuscript took place.
  * `BreakawayAlphaDiversity`: Calculations of alpha diversity using the breakaway package. Called by `ConventioanlAlpha.Rmd`
  * `ConventionalAlpha.Rmd` All of the alpha diversity calculations, including the ones for the manuscript.
     Note that we settled on sharing Breakaway richness, Shannon Diversity and Evenness (Breakawy/Shannon)
  * `Exemplars.Rmd` Gives an example of the abundance patterns of one microbe at one site. Used in proposals but not the manuscript.
  * `AllMicrobesFigures.qmd`: Plots of total microbial abundance per L and per mg of particles.
  * `MockExplore.Rmd`: Provides a sanity check of the mock community data. In the manuscript, I mostly go so far as to say "looks good" but anyone is welcome to explore these more.
  * `OstensiblyFree`: Exploration of the bacteria that are "free living" in that they comprise at least 1% of the microbial community. Here I show that *all* of these microbes are also found on some particle size fractions.
  * `SummaryDataOverview.Rmd`: Some overview data about amplicon sequence quality.
* `CB2019_SRA_Upload`: Sequence data were uploaded to sequence read archive. I prepared the metadata for that upload herein.
* `DadaData`: Output data from DADA2. I use it as inputs for much of my analysis here. Its mainly read in by `RScripts/InitialProcessing_3.R`.
* `InputData`: Some data files that I need for the analysis
  * `EnvDataForAmplicons.csv`: Data about particle abundance, mass and DNA content in eah environmental sample.
  * `Stations.csv` Station information compiled by Sairah Malkin. Contains, latitude, longitude, location depth, and DO climatology (I'm not sure how it was chosen exactly) which we used to choose sites.
* `Keys`: Metadata about samples. Much is left over from upstream analysis, but some important enviormentla data here.
  * `SampleKey1.csv`: Information about inital fasta files. 
    * Run: Which run they are from.
    * Files: Original file name
    * ID: Sample ID for the project.
    * ReadDir: Read direction:
    * Sample: Same as ID.
    * Station, Depth, Size: Where from, how deep how big.
   * Type: There are three "Samples" are the enviornmental samples. PControl are PCR control. EControl are DNA extraction controls. "Mock" are mock communities. Even and staggered. See the `Info` directory for more. GD are generous donor samples. Collected from the HPL pier for cross comparison.
  * `SampleKey2.csv`: Contains names of intermediate data files from the amplicon data processing. That process doesn't happenin this project directory.
  * `Sampels.txt`: All sample names. Used for upstream processing
  * `samples_doubled`: As above, but two of each. Useful sometimes in upstream processing.
  * `ManualFlags2.csv`: Some of the data were bad. I flagged those samples here. Those data get not used in the `InitialProcessing_3.R` script.
  * `SampleDepths`: Information about how deep different samples were taken, in meters.
  * `Use_CTD2.csv`: CTD data corresponding to where samples were taken.
    
* `Figures`: Figures, generated by scripts and notebooks. Many were used in the manuscript.
* `Tables`: Tables of data, usually produced by flextable package and saved to ms word. Most are used in the manuscript. Also `nonSpikes.csv.gz` was the all processed data table that I hope to upload with the manuscript as a supplemental huge table. This file is too big for github and has been replaced with `normalized_abundance.csv.gz`, `sampleData.csv` and `taxa.csv` which contain information for supplmental tables S1-S3.
* `Info`: Information about the mock community data. Provided by BRI
* `IntermediateData`: Data files generated by some scripts that are used by other scripts.
* `Microscopy`: Analysis of microscopy count data and comparison to amplicon based count data.
* `OldData`: An archive, but for data I'm not using currently.
* `PiCrustStuff`: I had to run part of the picrust pipeline to generate the data that I used to look for biogeochemically interesting ASVs. That upstream analysis lives here.
* `RDataFiles`: Data files storing primarely output from InitialProcessing_3.R, in different forms for use by other scripts.
* `renv`: I use renv for package management. Relevant libraries should automatically load themselves locally when somebody tries to run this project.
* `renv.lock` Is in the root directory but its a lock file for renv.
* `RLibraries`: Files with functions that many scripts call.
  * `ChesapeakePersonalLibrary.R` Functions that get used a lot by other scritps.
  * `Brigandine_Library.R`: I call the plots with overlapping circles "Brigandine Plots" because they look a bit like brigandine armor. Here are the code for generating those plots. Its not super generalizable, just works in the context of this project, but I encourage their adaptation for other projects.
A bunch of the directories are effectively Archives. They contain files I'm not using in the final version. I could nest them
but I'm afraid I'll break something
* `Archive`: Old scripts and plots that I used at earlier stages of the project. They didn't end up in the final manuscript. They have not been tested recently so many of them may not run out of the box.
* `ScratchFigures`: Archive, but for figures I'm not using any more
* `ScratchNotebooks`: Like `Archive` but specifically for notebook files I'm not using anymore

Note: Two files are too big for github and will were filtered out before posting. 
`query_aligh.stockholm`
`ref_seqs_hhmalign.fasta`


